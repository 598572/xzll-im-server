# 好友请求功能使用示例

## 📖 场景说明

本示例演示如何使用交互式测试客户端处理好友请求。

### 角色
- **用户A (user1)**: 好友申请发起人
- **用户B (testuser)**: 好友申请接收人（使用交互式客户端）

---

## 🎬 完整流程演示

### 步骤1: 启动交互式客户端（用户B）

```bash
cd im-client
./run_interactive_client.sh
```

输入当前用户ID：
```
╔════════════════════════════════════════════════════╗
║     交互式 IM 测试客户端 - 启动配置               ║
╚════════════════════════════════════════════════════╝

请输入当前用户ID（发送方，例如: user1）: testuser
✅ 当前用户: testuser

正在连接服务器...
✅ 连接成功！

╔════════════════════════════════════════════════════╗
║                   可用命令列表                      ║
╠════════════════════════════════════════════════════╣
║  send / s                  - 发送消息（完整模式）   ║
║  quick <接收方ID> / q      - 快速发送模式          ║
║  friend <子命令> / f       - 好友请求管理          ║
║    accept <requestId>      - 同意好友请求          ║
║    reject <requestId>      - 拒绝好友请求          ║
║    list                    - 查看待处理请求        ║
║  status                    - 查看连接状态          ║
║  help / h                  - 显示帮助信息          ║
║  clear / cls               - 清屏                  ║
║  exit / quit               - 退出程序              ║
╚════════════════════════════════════════════════════╝

> _
```

### 步骤2: 用户A发送好友请求

在另一个终端或使用HTTP工具发送好友请求：

```bash
curl -X POST http://127.0.0.1:8083/api/friend/request/send \
  -H "Content-Type: application/json" \
  -d '{
    "fromUserId": "user1",
    "toUserId": "testuser",
    "requestMessage": "你好，我是user1，想加你为好友！"
  }'
```

### 步骤3: 用户B收到好友请求推送

交互式客户端会自动显示：

```
> 

╔════════════════════════════════════════════════════╗
║              👥 收到好友请求                        ║
╠════════════════════════════════════════════════════╣
║  申请人: 张三 (user1)
║  申请消息: 你好，我是user1，想加你为好友！
║  请求ID: 1234567890abcdef
╠════════════════════════════════════════════════════╣
║  💡 处理方式:                                      ║
║     同意: friend accept 1234567890abcdef           ║
║     拒绝: friend reject 1234567890abcdef           ║
║     查看: friend list                              ║
╚════════════════════════════════════════════════════╝

> _
```

### 步骤4a: 同意好友请求

```bash
> friend accept 1234567890abcdef

[17:30:45] ⏳ 正在处理好友请求...
[17:30:46] ✅ 好友请求处理成功！
   操作: 同意 张三 的好友申请
   响应: {"code":200,"message":"操作成功","data":null}

> _
```

### 步骤4b: 或者拒绝好友请求

```bash
> friend reject 1234567890abcdef

[17:30:45] ⏳ 正在处理好友请求...
[17:30:46] ✅ 好友请求处理成功！
   操作: 拒绝 张三 的好友申请
   响应: {"code":200,"message":"操作成功","data":null}

> _
```

### 步骤5: 用户A收到好友响应

如果用户A也在使用客户端，会收到响应推送：

```
╔════════════════════════════════════════════════════╗
║            👥 好友申请响应                          ║
╠════════════════════════════════════════════════════╣
║  响应人: 测试用户
║  结果: ✅ 已同意
║  🎉 测试用户 同意了你的好友申请
╚════════════════════════════════════════════════════╝
```

---

## 🔥 高级场景

### 场景1: 同时收到多个好友请求

```bash
> 

╔════════════════════════════════════════════════════╗
║              👥 收到好友请求                        ║
╠════════════════════════════════════════════════════╣
║  申请人: 张三 (user1)
║  申请消息: 你好，我是user1
║  请求ID: req-001
╠════════════════════════════════════════════════════╣
║  💡 处理方式:                                      ║
║     同意: friend accept req-001                    ║
║     拒绝: friend reject req-001                    ║
║     查看: friend list                              ║
╚════════════════════════════════════════════════════╝

╔════════════════════════════════════════════════════╗
║              👥 收到好友请求                        ║
╠════════════════════════════════════════════════════╣
║  申请人: 李四 (user2)
║  申请消息: Hi，认识一下
║  请求ID: req-002
╠════════════════════════════════════════════════════╣
║  💡 处理方式:                                      ║
║     同意: friend accept req-002                    ║
║     拒绝: friend reject req-002                    ║
║     查看: friend list                              ║
╚════════════════════════════════════════════════════╝

> friend list

╔════════════════════════════════════════════════════╗
║            待处理的好友请求列表                     ║
╠════════════════════════════════════════════════════╣
║
║  [1] 申请人: 张三 (user1)
║      消息: 你好，我是user1
║      请求ID: req-001
║      同意: friend accept req-001
║      拒绝: friend reject req-001
║
║  [2] 申请人: 李四 (user2)
║      消息: Hi，认识一下
║      请求ID: req-002
║      同意: friend accept req-002
║      拒绝: friend reject req-002
╚════════════════════════════════════════════════════╝

> friend accept req-001
[17:30:45] ✅ 好友请求处理成功！
   操作: 同意 张三 的好友申请

> friend accept req-002
[17:30:46] ✅ 好友请求处理成功！
   操作: 同意 李四 的好友申请

> friend list

┌─────────────────────────────────────┐
│      暂无待处理的好友请求           │
└─────────────────────────────────────┘
```

### 场景2: 忘记请求ID，查看列表

```bash
> friend list

╔════════════════════════════════════════════════════╗
║            待处理的好友请求列表                     ║
╠════════════════════════════════════════════════════╣
║
║  [1] 申请人: 王五 (user3)
║      消息: 想和你交个朋友
║      请求ID: req-abc-123
║      同意: friend accept req-abc-123
║      拒绝: friend reject req-abc-123
╚════════════════════════════════════════════════════╝

> friend accept req-abc-123
[17:30:45] ✅ 好友请求处理成功！
```

### 场景3: 输入错误的请求ID

```bash
> friend accept wrong-id

[17:30:45] ❌ 未找到请求ID: wrong-id
💡 提示: 使用 'friend list' 查看所有待处理的请求

> friend list
# 查看正确的ID后重试
```

---

## 💡 使用技巧

### 技巧1: 使用命令简写

```bash
# 完整命令
> friend list
> friend accept req-123
> friend reject req-456

# 简写命令（更快）
> f l
> f a req-123
> f r req-456
```

### 技巧2: 复制粘贴请求ID

收到好友请求时，直接复制显示的命令：

```
║     同意: friend accept 1234567890abcdef
```

直接粘贴到命令行：
```bash
> friend accept 1234567890abcdef
```

### 技巧3: 批量处理

使用 `friend list` 查看所有请求后，依次处理：

```bash
> f l
# 查看列表
> f a req-001
> f a req-002
> f r req-003
# 批量处理
```

---

## ❓ 常见问题

### Q1: 收到好友请求后必须立即处理吗？

**A**: 不需要。好友请求会保存在内存中，您可以：
1. 立即处理
2. 使用 `friend list` 稍后查看
3. 重启客户端后请求会丢失（需要重新接收）

### Q2: 如何知道请求已处理成功？

**A**: 处理成功后会显示：
```
✅ 好友请求处理成功！
   操作: 同意/拒绝 XXX 的好友申请
```

### Q3: 可以撤销已处理的请求吗？

**A**: 不可以。一旦同意或拒绝，请求会从待处理列表中移除。

### Q4: 好友请求推送失败怎么办？

**A**: 
- 检查客户端是否在线
- 查看服务端日志
- 使用 HTTP 接口直接查询好友请求列表

---

## 🔗 相关接口

### 发送好友请求
```bash
POST /api/friend/request/send
Content-Type: application/json

{
  "fromUserId": "user1",
  "toUserId": "testuser",
  "requestMessage": "申请消息"
}
```

### 处理好友请求
```bash
POST /api/friend/request/handle
Content-Type: application/json

{
  "requestId": "req-xxx-yyy",
  "userId": "testuser",
  "handleResult": 1  // 1=同意, 2=拒绝
}
```

### 查询好友请求列表
```bash
GET /api/friend/request/list?userId=testuser
```

---

## 📝 总结

交互式测试客户端的好友请求功能提供了：

✅ **实时推送** - 自动接收好友请求  
✅ **灵活处理** - 可立即或稍后处理  
✅ **便捷查看** - `friend list` 查看所有待处理请求  
✅ **简洁命令** - 支持命令简写（`f a/r/l`）  
✅ **友好提示** - 自动显示处理命令  


---


