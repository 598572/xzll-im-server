# XZLL-IM ç³»ç»Ÿæ¶æ„å›¾

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

XZLL-IM æ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„åˆ†å¸ƒå¼å³æ—¶é€šè®¯ç³»ç»Ÿï¼Œé‡‡ç”¨ Spring Cloud + Dubbo + Netty æŠ€æœ¯æ ˆï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨çš„å®æ—¶æ¶ˆæ¯é€šä¿¡ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    %% å®¢æˆ·ç«¯å±‚
    subgraph "å®¢æˆ·ç«¯å±‚"
        WEB[Webå®¢æˆ·ç«¯]
        MOBILE[ç§»åŠ¨ç«¯å®¢æˆ·ç«¯]
        PC[PCå®¢æˆ·ç«¯]
    end

    %% è´Ÿè½½å‡è¡¡å±‚
    subgraph "è´Ÿè½½å‡è¡¡å±‚"
        NGINX[Nginx<br/>è´Ÿè½½å‡è¡¡+åå‘ä»£ç†<br/>80/443]
    end

    %% ç½‘å…³å±‚
    subgraph "ç½‘å…³å±‚"
        GW[Gatewayç½‘å…³<br/>8081<br/>Spring Cloud Gateway]
    end

    %% ä¸šåŠ¡æœåŠ¡å±‚ - Docker Composeéƒ¨ç½²
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚ (Docker Compose)"
        AUTH[è®¤è¯æœåŠ¡<br/>im-auth:8082<br/>OAuth2+Spring Security]
        CONNECT[é•¿è¿æ¥æœåŠ¡<br/>im-connect:10001<br/>Netty WebSocket]
        BUSINESS[ä¸šåŠ¡æœåŠ¡<br/>im-business:8083<br/>æ ¸å¿ƒæ¶ˆæ¯å¤„ç†]
        CONSOLE[æ§åˆ¶å°æœåŠ¡<br/>im-console:8084<br/>ç®¡ç†åå°]
        DATASYNC[æ•°æ®åŒæ­¥æœåŠ¡<br/>im-data-sync:8085<br/>HBaseâ†’ESåŒæ­¥]
    end

    %% ä¸­é—´ä»¶å±‚
    subgraph "æ³¨å†Œä¸­å¿ƒ/é…ç½®ä¸­å¿ƒ"
        NACOS[Nacos<br/>æœåŠ¡å‘ç°+é…ç½®ä¸­å¿ƒ<br/>8848]
        ZK[ZooKeeper<br/>Dubboæ³¨å†Œä¸­å¿ƒ<br/>2181]
    end

    subgraph "æ¶ˆæ¯é˜Ÿåˆ—"
        RMQ[RocketMQ<br/>å¼‚æ­¥æ¶ˆæ¯å¤„ç†<br/>9876]
    end

    %% å­˜å‚¨å±‚
    subgraph "å­˜å‚¨å±‚"
        MYSQL[(MySQL<br/>ç”¨æˆ·ä¿¡æ¯/ä¼šè¯æ•°æ®<br/>3306)]
        HBASE[(HBase<br/>æ¶ˆæ¯å­˜å‚¨<br/>é›†ç¾¤éƒ¨ç½²)]
        REDIS[(Redis<br/>ç¼“å­˜/åˆ†å¸ƒå¼é”<br/>6379)]
        ES[(Elasticsearch<br/>æ¶ˆæ¯æœç´¢<br/>9200)]
    end

    %% ç›‘æ§å±‚
    subgraph "ç›‘æ§è§‚æµ‹"
        PROMETHEUS[Prometheus<br/>æŒ‡æ ‡é‡‡é›†<br/>9090]
        GRAFANA[Grafana<br/>ç›‘æ§é¢æ¿<br/>3000]
    end

    %% CI/CDå±‚
    subgraph "CI/CDéƒ¨ç½²"
        JENKINS[Jenkins<br/>æŒç»­é›†æˆ<br/>Pipelineè„šæœ¬]
        DOCKER[Docker Compose<br/>å®¹å™¨ç¼–æ’éƒ¨ç½²]
        GIT[Gitä»“åº“<br/>æºç ç®¡ç†]
    end

    %% è¿æ¥å…³ç³»
    WEB --> NGINX
    MOBILE --> NGINX
    PC --> NGINX

    NGINX --> GW
    NGINX --> CONNECT

    GW --> AUTH
    GW --> BUSINESS
    GW --> CONSOLE

    %% æœåŠ¡æ³¨å†Œå‘ç°
    AUTH --> NACOS
    BUSINESS --> NACOS
    CONSOLE --> NACOS
    GW --> NACOS

    %% Dubbo RPC
    CONNECT --> ZK
    BUSINESS --> ZK
    CONNECT -.->|Dubbo RPC| BUSINESS

    %% æ•°æ®å­˜å‚¨
    AUTH --> MYSQL
    BUSINESS --> MYSQL
    BUSINESS --> HBASE
    CONNECT --> REDIS
    BUSINESS --> REDIS

    %% æ¶ˆæ¯é˜Ÿåˆ—
    BUSINESS --> RMQ
    DATASYNC --> RMQ
    DATASYNC --> ES

    %% ç›‘æ§
    CONNECT --> PROMETHEUS
    PROMETHEUS --> GRAFANA

    %% CI/CDæµç¨‹
    GIT --> JENKINS
    JENKINS --> DOCKER
    DOCKER --> AUTH
    DOCKER --> CONNECT
    DOCKER --> BUSINESS
    DOCKER --> CONSOLE
    DOCKER --> DATASYNC

    %% æ ·å¼å®šä¹‰
    classDef client fill:#e1f5fe
    classDef proxy fill:#f8bbd9
    classDef gateway fill:#f3e5f5
    classDef service fill:#e8f5e8
    classDef middleware fill:#fff3e0
    classDef storage fill:#fce4ec
    classDef monitor fill:#f1f8e9
    classDef cicd fill:#e0f2f1

    class WEB,MOBILE,PC client
    class NGINX proxy
    class GW gateway
    class AUTH,CONNECT,BUSINESS,CONSOLE,DATASYNC service
    class NACOS,ZK,RMQ middleware
    class MYSQL,HBASE,REDIS,ES storage
    class PROMETHEUS,GRAFANA monitor
    class JENKINS,DOCKER,GIT cicd
```

---

## ğŸ“‹ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### ğŸŒ è´Ÿè½½å‡è¡¡ä¸ç½‘å…³å±‚
| æœåŠ¡ | ç«¯å£ | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|------|--------|
| **Nginx** | 80/443 | è´Ÿè½½å‡è¡¡ï¼Œåå‘ä»£ç†ï¼ŒSSLç»ˆæ­¢ | Nginx |
| **im-gateway** | 8081 | ç»Ÿä¸€APIç½‘å…³ï¼Œè·¯ç”±è½¬å‘ï¼ŒæœåŠ¡å‘ç° | Spring Cloud Gateway |

### ğŸ” ä¸šåŠ¡æœåŠ¡å±‚
| æœåŠ¡ | ç«¯å£ | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|------|--------|
| **im-auth** | 8082 | ç”¨æˆ·è®¤è¯ã€æˆæƒã€JWTä»¤ç‰Œç®¡ç† | OAuth2 + Spring Security |
| **im-connect** | 10001 | WebSocketé•¿è¿æ¥ç®¡ç†ï¼Œå®æ—¶æ¶ˆæ¯æ¨é€ | Netty + WebSocket |
| **im-business** | 8083 | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ¶ˆæ¯å¤„ç†ï¼Œæ•°æ®æŒä¹…åŒ– | Spring Boot + Dubbo |
| **im-console** | 8084 | ç®¡ç†åå°ï¼Œæ¶ˆæ¯æŸ¥è¯¢ï¼Œç³»ç»Ÿç›‘æ§ | Spring Boot |
| **im-data-sync** | 8085 | æ•°æ®åŒæ­¥ï¼ŒHBaseåˆ°ESçš„å¼‚æ­¥åŒæ­¥ | Spring Boot + RocketMQ |

### ğŸ—ƒï¸ å­˜å‚¨æ¶æ„

#### ä¸»å­˜å‚¨ç³»ç»Ÿ
- **MySQL**: ç”¨æˆ·ä¿¡æ¯ã€ä¼šè¯æ•°æ®ã€å¥½å‹å…³ç³»ç­‰ç»“æ„åŒ–æ•°æ®
- **HBase**: æµ·é‡æ¶ˆæ¯è®°å½•å­˜å‚¨ï¼Œæ”¯æŒé«˜å¹¶å‘å†™å…¥
- **Redis**: ç¼“å­˜ç”¨æˆ·çŠ¶æ€ã€åœ¨çº¿ä¿¡æ¯ã€åˆ†å¸ƒå¼é”

#### æœç´¢å¼•æ“
- **Elasticsearch**: æ¶ˆæ¯å…¨æ–‡æœç´¢ã€å¤æ‚æŸ¥è¯¢ã€æ•°æ®åˆ†æ

---

## ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ğŸ“± ç”¨æˆ·ç™»å½•æµç¨‹
```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant G as Gateway
    participant A as AuthæœåŠ¡
    participant N as Nacos
    participant R as Redis

    C->>G: ç™»å½•è¯·æ±‚
    G->>A: è½¬å‘è®¤è¯è¯·æ±‚
    A->>N: éªŒè¯ç”¨æˆ·ä¿¡æ¯
    A->>R: ç¼“å­˜ç”¨æˆ·çŠ¶æ€
    A->>G: è¿”å›JWT Token
    G->>C: ç™»å½•æˆåŠŸ
    Note over C: å®¢æˆ·ç«¯å»ºç«‹WebSocketè¿æ¥
    C->>Connect: WebSocketè¿æ¥
```

### ğŸ’¬ æ¶ˆæ¯å‘é€æµç¨‹
```mermaid
sequenceDiagram
    participant C1 as å‘é€æ–¹å®¢æˆ·ç«¯
    participant CON as ConnectæœåŠ¡
    participant BIZ as BusinessæœåŠ¡
    participant H as HBase
    participant MQ as RocketMQ
    participant DS as DataSyncæœåŠ¡
    participant ES as Elasticsearch
    participant C2 as æ¥æ”¶æ–¹å®¢æˆ·ç«¯

    C1->>CON: å‘é€æ¶ˆæ¯
    CON->>BIZ: Dubbo RPCè°ƒç”¨
    BIZ->>H: å­˜å‚¨æ¶ˆæ¯
    BIZ->>MQ: å‘é€åŒæ­¥æ¶ˆæ¯
    BIZ->>CON: è¿”å›æ¶ˆæ¯å¤„ç†ç»“æœ
    CON->>C2: æ¨é€æ¶ˆæ¯åˆ°æ¥æ”¶æ–¹
    
    par å¼‚æ­¥æ•°æ®åŒæ­¥
        MQ->>DS: æ¶ˆè´¹åŒæ­¥æ¶ˆæ¯
        DS->>ES: å†™å…¥æœç´¢å¼•æ“
    end
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦æƒ…

### æ ¸å¿ƒæ¡†æ¶
- **Spring Boot**: 2.7.0
- **Spring Cloud**: 2021.0.3  
- **Dubbo**: 3.0.7
- **Netty**: 4.1.75.Final

### ä¸­é—´ä»¶
- **Nacos**: æœåŠ¡å‘ç° + é…ç½®ä¸­å¿ƒ
- **ZooKeeper**: Dubboæ³¨å†Œä¸­å¿ƒ
- **RocketMQ**: 4.5.0 å¼‚æ­¥æ¶ˆæ¯å¤„ç†
- **Redis**: ç¼“å­˜ + åˆ†å¸ƒå¼é”
- **Redisson**: åˆ†å¸ƒå¼é”å®ç°

### æ•°æ®å­˜å‚¨
- **MySQL**: 8.0.23 å…³ç³»å‹æ•°æ®
- **HBase**: 2.5.7-hadoop3 æ¶ˆæ¯å­˜å‚¨
- **Elasticsearch**: å…¨æ–‡æœç´¢
- **MyBatis Plus**: ORMæ¡†æ¶

### ç›‘æ§è¿ç»´
- **Prometheus**: æŒ‡æ ‡é‡‡é›†
- **Grafana**: ç›‘æ§é¢æ¿
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **Jenkins**: CI/CD

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨
| è¡¨å | ç”¨é€” | å­˜å‚¨å¼•æ“ |
|------|------|----------|
| `im_user` | ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ | MySQL |
| `im_chat` | ä¼šè¯ä¿¡æ¯ | MySQL |
| `im_chat_user_opt` | ç”¨æˆ·ä¼šè¯æ“ä½œè®°å½• | MySQL |
| `im_friend_relation` | å¥½å‹å…³ç³» | MySQL |
| `c2c_msg_record` | å•èŠæ¶ˆæ¯è®°å½• | HBase |

### æ¶ˆæ¯å­˜å‚¨ç­–ç•¥
- **HBase**: ä¸»å­˜å‚¨ï¼ŒRowKeyè®¾è®¡æ”¯æŒé«˜æ•ˆæŸ¥è¯¢
- **Elasticsearch**: è¾…åŠ©å­˜å‚¨ï¼Œæ”¯æŒå…¨æ–‡æœç´¢å’Œå¤æ‚æŸ¥è¯¢
- **Redis**: ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½

---

## ğŸš€ ç³»ç»Ÿç‰¹æ€§

### é«˜å¯ç”¨æ€§
- å¾®æœåŠ¡æ¶æ„ï¼ŒæœåŠ¡ç‹¬ç«‹éƒ¨ç½²
- NacosæœåŠ¡å‘ç°ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»
- Redisé›†ç¾¤ï¼Œæ•°æ®é«˜å¯ç”¨

### é«˜æ€§èƒ½
- Netty NIOé«˜æ€§èƒ½ç½‘ç»œæ¡†æ¶
- HBaseåˆ†å¸ƒå¼å­˜å‚¨ï¼Œæ”¯æŒæµ·é‡æ•°æ®
- Redisç¼“å­˜ï¼Œæ¯«ç§’çº§å“åº”
- å¼‚æ­¥æ¶ˆæ¯å¤„ç†ï¼Œå‰Šå³°å¡«è°·

### å¯æ‰©å±•æ€§
- æ°´å¹³æ‰©å±•ï¼ŒæŒ‰éœ€å¢åŠ æœåŠ¡å®ä¾‹
- æ•°æ®åˆ†åº“åˆ†è¡¨æ”¯æŒ
- æ’ä»¶åŒ–æ¶ˆæ¯å¤„ç†å™¨

### å¯è§‚æµ‹æ€§
- PrometheusæŒ‡æ ‡ç›‘æ§
- Grafanaå¯è§†åŒ–é¢æ¿
- åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼ˆè§„åˆ’ä¸­ï¼‰

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### ğŸ“¦ CI/CD æµç¨‹
```mermaid
graph LR
    A[å¼€å‘æ¨é€ä»£ç ] --> B[Gitä»“åº“]
    B --> C[Jenkins Pipelineè§¦å‘]
    C --> D[Mavenæ„å»ºæ‰“åŒ…]
    D --> E[Dockeré•œåƒæ„å»º]
    E --> F[Docker Composeéƒ¨ç½²]
    F --> G[æœåŠ¡å¥åº·æ£€æŸ¥]
    G --> H[éƒ¨ç½²å®Œæˆ]
```

### ğŸ³ Docker Compose æœåŠ¡ç¼–æ’
- **ç»Ÿä¸€éƒ¨ç½²**: æ‰€æœ‰å¾®æœåŠ¡é€šè¿‡docker-compose.ymlç»Ÿä¸€ç¼–æ’
- **ç½‘ç»œéš”ç¦»**: æœåŠ¡é—´é€šè¿‡Dockerç½‘ç»œé€šä¿¡
- **æ•°æ®æŒä¹…åŒ–**: å…³é”®æ•°æ®ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœº
- **æ—¥å¿—é›†ä¸­**: ç»Ÿä¸€æ—¥å¿—ç›®å½•ä¾¿äºè¿ç»´ç®¡ç†

### ğŸŒ Nginx é…ç½®ç­–ç•¥
- **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹æœåŠ¡çš„è´Ÿè½½åˆ†å‘
- **åå‘ä»£ç†**: éšè—å†…éƒ¨æœåŠ¡ç«¯å£ï¼Œç»Ÿä¸€å¯¹å¤–æš´éœ²
- **SSLç»ˆæ­¢**: HTTPSè¯ä¹¦ç®¡ç†å’ŒSSLå¸è½½
- **é™æ€èµ„æº**: å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡

---

## ğŸ”® å‘å±•è§„åˆ’

### å·²å®ç°åŠŸèƒ½ âœ…
- ç”¨æˆ·è®¤è¯ä¸æˆæƒ
- å•èŠæ¶ˆæ¯å‘é€ä¸æ¥æ”¶
- æ¶ˆæ¯å­˜å‚¨ä¸æœç´¢
- æœåŠ¡ç›‘æ§ä¸å‘Šè­¦
- Dockerå®¹å™¨åŒ–éƒ¨ç½²
- Jenkins CI/CDæµæ°´çº¿
- Nginxè´Ÿè½½å‡è¡¡

### å¼€å‘ä¸­åŠŸèƒ½ ğŸš§
- ç¾¤èŠåŠŸèƒ½
- ç¦»çº¿æ¶ˆæ¯æ¨é€
- æ¶ˆæ¯åŠ å¯†ä¼ è¾“
- ç§»åŠ¨ç«¯é€‚é…

### è§„åˆ’åŠŸèƒ½ ğŸ“‹
- Kuberneteséƒ¨ç½²
- éŸ³è§†é¢‘é€šè¯
- æ–‡ä»¶ä¼ è¾“
- æ¶ˆæ¯æ’¤å›ä¸ç¼–è¾‘
- è¡¨æƒ…åŒ…æ”¯æŒ
- æœºå™¨äººé›†æˆ

---

## ğŸ“Š å¦‚ä½•æŸ¥çœ‹Mermaidå›¾å½¢

### åœ¨IDEAä¸­æŸ¥çœ‹
1. **å®‰è£…æ’ä»¶**: 
   - æ‰“å¼€ IDEA â†’ File â†’ Settings â†’ Plugins
   - æœç´¢å¹¶å®‰è£… "Mermaid" æ’ä»¶
   - é‡å¯IDEA

2. **æŸ¥çœ‹å›¾å½¢**:
   - æ‰“å¼€ `.md` æ–‡ä»¶
   - å³é”®é€‰æ‹© "Open in Browser" æˆ– "Preview"
   - æˆ–è€…ä½¿ç”¨IDEAçš„Markdowné¢„è§ˆé¢æ¿

### åœ¨çº¿æŸ¥çœ‹æ–¹å¼
1. **Mermaid Live Editor**: https://mermaid.live/
   - å¤åˆ¶mermaidä»£ç ç›´æ¥ç²˜è´´æŸ¥çœ‹
   
2. **GitHub/GitLab**: 
   - ç›´æ¥åœ¨ä»“åº“ä¸­æŸ¥çœ‹markdownæ–‡ä»¶
   - è‡ªåŠ¨æ¸²æŸ“mermaidå›¾å½¢

3. **VSCode**: 
   - å®‰è£… "Mermaid Preview" æ’ä»¶
   - å®æ—¶é¢„è§ˆå›¾å½¢æ•ˆæœ

### å…¶ä»–å·¥å…·
- **Typora**: æ”¯æŒåŸç”Ÿmermaidæ¸²æŸ“
- **Notion**: æ”¯æŒmermaidå›¾å½¢
- **Obsidian**: é€šè¿‡æ’ä»¶æ”¯æŒ

---

## ğŸ“ è”ç³»æ–¹å¼

**ä½œè€…**: èå­è±è±çˆ±æ‰“æ€ª  
**é‚®ç®±**: h163361631@163.com  
**é¡¹ç›®åœ°å€**: [GitHubé“¾æ¥]

> ğŸ’¡ è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ¬¢è¿è´¡çŒ®ä»£ç å’Œæå‡ºæ”¹è¿›å»ºè®®ï¼
